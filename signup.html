<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petples íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ì¶”ê°€ëœ ìŠ¤íƒ€ì¼ */
        .optional-label::after {
            content: ' (ì„ íƒ)';
            font-weight: normal;
            color: #777;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="images/app_icon.png" alt="í«í”ŒìŠ¤ ì•± ì•„ì´ì½˜">
                <h1><a href="index.html">í«í”ŒìŠ¤</a></h1>
            </div>
            <nav class="nav">
                <ul id="nav-menu">
                    <li><a href="inquiry.html">1:1 ë¬¸ì˜</a></li>
                    <!-- auth.jsê°€ ë™ì ìœ¼ë¡œ ì±„ì›ë‹ˆë‹¤ -->
                </ul>
            </nav>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="container">
            <section class="form-section">
                <h2>ğŸ¾ í«í”ŒìŠ¤ íšŒì›ê°€ì…</h2>
                <p>ë³´í˜¸ìë‹˜ê³¼ ë°˜ë ¤ë™ë¬¼ì˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <form id="signup-form" class="auth-form" enctype="multipart/form-data">
                    <h3>ë³´í˜¸ì ì •ë³´</h3>
                    <div class="form-group">
                        <label for="userid">ì•„ì´ë””</label>
                        <input type="text" id="userid" name="userid" placeholder="ì‚¬ìš©í•  ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="password" name="password" placeholder="ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label for="human-name">ì´ë¦„</label>
                        <input type="text" id="human-name" name="human_name" placeholder="ë³´í˜¸ìë‹˜ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label for="human-age">ë‚˜ì´</label>
                        <input type="number" id="human-age" name="human_age" placeholder="ë³´í˜¸ìë‹˜ì˜ ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label>ì„±ë³„</label>
                        <div class="radio-group">
                            <label><input type="radio" name="human_gender" value="ë‚¨ì„±" required> ë‚¨ì„±</label>
                            <label><input type="radio" name="human_gender" value="ì—¬ì„±" required> ì—¬ì„±</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="human-photo">ì‚¬ì§„ (1ê°œ)</label>
                        <input type="file" id="human-photo" name="human_photo" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="preferred-breed" class="optional-label">ë§¤ì¹­ ì„ í˜¸ ì¢…</label>
                        <input type="text" id="preferred-breed" name="preferred_breed" placeholder="ì„ í˜¸í•˜ëŠ” ë™ë¬¼/í’ˆì¢…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="lifestyle" class="optional-label">ìƒí™œ ì–‘ì‹</label>
                        <textarea id="lifestyle" name="lifestyle" rows="3" placeholder="ì˜ˆ: ì£¼ë§ë§ˆë‹¤ ê³µì›ì— ê°€ìš”, í™œë™ì ì¸ í¸ì´ì—ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="neighborhood" class="optional-label">ì‚¬ëŠ” ë™ë„¤</label>
                        <input type="text" id="neighborhood" name="neighborhood" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬">
                    </div>

                    <hr>

                    <h3>ë°˜ë ¤ë™ë¬¼ ì •ë³´</h3>
                    <div class="form-group">
                        <label for="pet-type">ë™ë¬¼ ì¢…ë¥˜</label>
                        <select id="pet-type" name="pet_type" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ê°•ì•„ì§€">ê°•ì•„ì§€</option>
                            <option value="ê³ ì–‘ì´">ê³ ì–‘ì´</option>
                            <option value="ì•µë¬´ìƒˆ">ì•µë¬´ìƒˆ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pet-photo">ì‚¬ì§„ (1ê°œ)</label>
                        <input type="file" id="pet-photo" name="pet_photo" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="pet-breed">í’ˆì¢…</label>
                        <input type="text" id="pet-breed" name="pet_breed" placeholder="ë™ë¬¼ ì¢…ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”." required>
                    </div>
                    <div class="form-group">
                        <label for="pet-age">ë‚˜ì´</label>
                        <input type="number" id="pet-age" name="pet_age" placeholder="ë°˜ë ¤ë™ë¬¼ì˜ ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label for="pet-weight">ëª¸ë¬´ê²Œ(kg)</label>
                        <input type="number" id="pet-weight" name="pet_weight" step="0.1" placeholder="ì˜ˆ: 5.5" required>
                    </div>
                    <div class="form-group">
                        <label>ì„±ë³„</label>
                        <div class="radio-group">
                            <label><input type="radio" name="pet_gender" value="ìˆ˜ì»·" required> ìˆ˜ì»·</label>
                            <label><input type="radio" name="pet_gender" value="ì•”ì»·" required> ì•”ì»·</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="neutered">ì¤‘ì„±í™” ìˆ˜ìˆ  ìœ ë¬´</label>
                        <select id="neutered" name="neutered" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="true">ì˜ˆ</option>
                            <option value="false">ì•„ë‹ˆì˜¤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="vaccination">ì ‘ì¢…ë‚´ì—­</label>
                        <textarea id="vaccination" name="vaccination" rows="3" placeholder="ìµœê·¼ ì ‘ì¢… ë‚´ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="allergies">ì•ŒëŸ¬ì§€ ìœ ë¬´</label>
                        <textarea id="allergies" name="allergies" rows="3" placeholder="ì˜ˆ: ë‹­ê³ ê¸°, ìœ ì œí’ˆ ë“±. ì—†ëŠ” ê²½ìš° 'ì—†ìŒ'ìœ¼ë¡œ ê¸°ì¬" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="microchip" class="optional-label">ì¹© ë“±ë¡ ì—¬ë¶€</label>
                        <select id="microchip" name="microchip">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="true">ë“±ë¡ë¨</option>
                            <option value="false">ë“±ë¡ ì•ˆ ë¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="personality" class="optional-label">ì„±ê²©</label>
                        <textarea id="personality" name="personality" rows="3" placeholder="ë°˜ë ¤ë™ë¬¼ì˜ ì„±ê²©ì„ ì•Œë ¤ì£¼ì„¸ìš”. ì˜ˆ: í™œë°œí•˜ê³  ì‚¬ëŒì„ ì¢‹ì•„í•´ìš”."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="preferred-snacks" class="optional-label">ì„ í˜¸ ê°„ì‹</label>
                        <input type="text" id="preferred-snacks" name="preferred_snacks" placeholder="ì¢‹ì•„í•˜ëŠ” ê°„ì‹ì´ ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì„¸ìš”.">
                    </div>

                    <div class="form-group">
                        <label for="pet-reg-number" class="optional-label">ë™ë¬¼ ë“±ë¡ì¦ ë²ˆí˜¸</label>
                        <input type="text" id="pet-reg-number" name="pet_reg_number" placeholder="ë“±ë¡ì¦ì´ ìˆë‹¤ë©´ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
                    </div>

                    <button type="submit" class="button-primary">ê°€ì…í•˜ê¸°</button>
                </form>
            </section>
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Petples. All Rights Reserved.</p>
            <p>íšŒì‚¬ì†Œê°œ | ì´ìš©ì•½ê´€ | ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</p>
        </div>
    </footer>

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const petTypeSelect = document.getElementById('pet-type');
            const petBreedInput = document.getElementById('pet-breed');

            petTypeSelect.addEventListener('change', function() {
                const selectedType = this.value;
                let placeholderText = 'í’ˆì¢…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';

                switch (selectedType) {
                    case 'ê°•ì•„ì§€':
                        placeholderText = 'ì˜ˆ: ì‹œë°”ê²¬, í‘¸ë“¤, ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„';
                        break;
                    case 'ê³ ì–‘ì´':
                        placeholderText = 'ì˜ˆ: ì½”ë¦¬ì•ˆ ìˆí—¤ì–´, í˜ë¥´ì‹œì•ˆ, ë™ëŒ';
                        break;
                    case 'ì•µë¬´ìƒˆ':
                        placeholderText = 'ì˜ˆ: ì‚¬ë‘ì•µë¬´, ì™•ê´€ì•µë¬´, ëª¨ë€ì•µë¬´';
                        break;
                    default:
                        placeholderText = 'ë™ë¬¼ ì¢…ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.';
                }
                petBreedInput.placeholder = placeholderText;
            });
        });

        document.getElementById('signup-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // í¼ ê¸°ë³¸ ì œì¶œ ë™ì‘ ë°©ì§€

            const formData = new FormData(this);
            const formProps = Object.fromEntries(formData);

            // íŒŒì¼ì„ Base64ë¡œ ì½ëŠ” Promise í•¨ìˆ˜
            const readFileAsDataURL = (file) => {
                return new Promise((resolve, reject) => {
                    if (!file || file.size === 0) {
                        resolve(null); // íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° null ë°˜í™˜
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            };

            try {
                // ë‘ íŒŒì¼ ì½ê¸°ë¥¼ ë™ì‹œì— ì§„í–‰
                const [humanPhotoData, petPhotoData] = await Promise.all([
                    readFileAsDataURL(formProps.human_photo),
                    readFileAsDataURL(formProps.pet_photo)
                ]);

                const user = {
                    // ê¸°ì¡´ ì •ë³´
                    userid: formProps.userid,
                    password: formProps.password, // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•´ì•¼ í•©ë‹ˆë‹¤.

                    // ì‚¬ëŒ í”„ë¡œí•„
                    human_name: formProps.human_name,
                    human_gender: formProps.human_gender,
                    human_age: formProps.human_age,
                    human_photo: humanPhotoData, // Base64 ë°ì´í„° ì €ì¥
                    preferred_breed: formProps.preferred_breed || 'ë¯¸ì…ë ¥',
                    lifestyle: formProps.lifestyle || 'ë¯¸ì…ë ¥',
                    neighborhood: formProps.neighborhood || 'ë¯¸ì…ë ¥',

                    // ë°˜ë ¤ë™ë¬¼ í”„ë¡œí•„
                    pet_type: formProps.pet_type,
                    pet_photo: petPhotoData, // Base64 ë°ì´í„° ì €ì¥
                    pet_breed: formProps.pet_breed,
                    pet_age: formProps.pet_age,
                    pet_weight: formProps.pet_weight,
                    pet_gender: formProps.pet_gender,
                    neutered: formProps.neutered,
                    vaccination: formProps.vaccination,
                    allergies: formProps.allergies,
                    microchip: formProps.microchip || 'ë¯¸ì„ íƒ',
                    personality: formProps.personality || 'ë¯¸ì…ë ¥',
                    preferred_snacks: formProps.preferred_snacks || 'ë¯¸ì…ë ¥',
                    pet_reg_number: formProps.pet_reg_number || 'ë¯¸ì…ë ¥'
                };

                localStorage.setItem('petples_user', JSON.stringify(user));
                alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! í™˜ì˜í•©ë‹ˆë‹¤!');
                window.location.href = 'index.html';
            } catch (error) {
                console.error("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
                alert("ì‚¬ì§„ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        });

    </script>

</body>
</html>